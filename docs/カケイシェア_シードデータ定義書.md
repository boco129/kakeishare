# カケイシェア シードデータ定義書

> **最終更新**: 2026-02-23
> **用途**: 開発・テスト用の初期データ。`prisma/seed.ts` で投入する。

---

## 1. ユーザー (users)

| id | name | email | role | password (hash前) |
|----|------|-------|------|-------------------|
| user_husband | 太郎 | taro@example.com | ADMIN | password123 |
| user_wife | 花子 | hanako@example.com | MEMBER | password123 |

**備考**:
- 太郎（夫）がメイン管理者。全操作が可能
- 花子（妻）は閲覧 + 自分の支出の編集のみ
- 本番ではパスワードをbcryptでハッシュ化

---

## 2. カテゴリ (categories)

| id | name | icon | is_fixed_cost | default_visibility | sort_order |
|----|------|------|---------------|-------------------|------------|
| cat_food | 食費 | 🍽 | false | PUBLIC | 1 |
| cat_daily | 日用品 | 🏪 | false | PUBLIC | 2 |
| cat_housing | 住居 | 🏠 | true | PUBLIC | 3 |
| cat_utility | 光熱費 | 💡 | true | PUBLIC | 4 |
| cat_telecom | 通信費 | 📱 | true | PUBLIC | 5 |
| cat_transport | 交通費 | 🚃 | false | PUBLIC | 6 |
| cat_social | 交際費 | 🍻 | false | AMOUNT_ONLY | 7 |
| cat_clothing | 衣服・美容 | 👗 | false | AMOUNT_ONLY | 8 |
| cat_medical | 医療 | 🏥 | false | AMOUNT_ONLY | 9 |
| cat_education | 教育 | 📚 | false | PUBLIC | 10 |
| cat_hobby | 個人娯楽 | 🎮 | false | CATEGORY_TOTAL | 11 |
| cat_subscription | サブスク | 🔄 | true | PUBLIC | 12 |
| cat_insurance | 保険 | 🛡 | true | PUBLIC | 13 |
| cat_car | 自動車 | 🚗 | false | PUBLIC | 14 |
| cat_other | その他 | 📦 | false | AMOUNT_ONLY | 15 |

**備考**:
- `is_fixed_cost`: 毎月ほぼ同額が発生する固定費か
- `default_visibility`: CSV取り込み時に自動適用される公開レベル
- `sort_order`: UI上の表示順

---

## 3. 予算 (budgets)

### 2026年1月分

| id | user_id | category_id | year_month | amount |
|----|---------|-------------|------------|--------|
| bud_01 | (shared) | cat_food | 2026-01 | 80000 |
| bud_02 | (shared) | cat_daily | 2026-01 | 30000 |
| bud_03 | (shared) | cat_housing | 2026-01 | 95000 |
| bud_04 | (shared) | cat_utility | 2026-01 | 15000 |
| bud_05 | (shared) | cat_telecom | 2026-01 | 20000 |
| bud_06 | (shared) | cat_transport | 2026-01 | 25000 |
| bud_07 | (shared) | cat_social | 2026-01 | 30000 |
| bud_08 | (shared) | cat_clothing | 2026-01 | 20000 |
| bud_09 | (shared) | cat_medical | 2026-01 | 10000 |
| bud_10 | (shared) | cat_hobby | 2026-01 | 30000 |
| bud_11 | (shared) | cat_subscription | 2026-01 | 5000 |
| bud_12 | (shared) | cat_insurance | 2026-01 | 10000 |
| bud_13 | (shared) | cat_car | 2026-01 | 10000 |
| bud_14 | (shared) | cat_other | 2026-01 | 20000 |

**月間予算合計: ¥400,000**

**備考**:
- 予算は家計全体（夫婦共通）で設定
- 2026年2月分も同額で複製する（seed時）

---

## 4. 支出 (expenses)

### 4.1 妻の支出（2026年1月・エポスカード）

日常的な買い物中心。プライバシー設定のテストケースを含む。

| date | description | amount | category_id | user_id | card_source | payment_method | visibility | is_confirmed | is_substitute | substitute_amount | memo |
|------|-------------|--------|-------------|---------|-------------|----------------|------------|--------------|---------------|-------------------|------|
| 2026-01-03 | マルエツ 豊洲店 | 2480 | cat_food | user_wife | epos | 1回払い | PUBLIC | true | false | null | |
| 2026-01-05 | スターバックス 渋谷店 | 580 | cat_food | user_wife | epos | 1回払い | PUBLIC | true | false | null | |
| 2026-01-07 | Amazon.co.jp | 3200 | cat_daily | user_wife | epos | 1回払い | PUBLIC | false | false | null | 掃除機フィルター |
| 2026-01-08 | セブン-イレブン 勝どき駅前店 | 890 | cat_food | user_wife | epos | 1回払い | PUBLIC | true | false | null | |
| 2026-01-10 | ユニクロ ららぽーと豊洲 | 5980 | cat_clothing | user_wife | epos | 1回払い | AMOUNT_ONLY | true | false | null | |
| 2026-01-12 | 居酒屋 魚民 新宿東口店 | 18500 | cat_social | user_wife | epos | 1回払い | AMOUNT_ONLY | true | true | 3700 | 5人で飲み会、立替 |
| 2026-01-14 | マツモトキヨシ 月島店 | 1240 | cat_daily | user_wife | epos | 1回払い | PUBLIC | true | false | null | |
| 2026-01-15 | ZARA オンラインストア | 12000 | cat_clothing | user_wife | epos | 3回払い | AMOUNT_ONLY | true | false | null | |
| 2026-01-17 | 東京メトロ 定期券 | 8400 | cat_transport | user_wife | epos | 1回払い | PUBLIC | true | false | null | |
| 2026-01-18 | Netflix | 1490 | cat_subscription | user_wife | epos | 1回払い | PUBLIC | true | false | null | 家族共有 |
| 2026-01-20 | 焼肉きんぐ 豊洲店 | 25600 | cat_food | user_wife | epos | 1回払い | PUBLIC | true | false | null | 家族ディナー |
| 2026-01-22 | ダイソー 豊洲店 | 330 | cat_daily | user_wife | epos | 1回払い | PUBLIC | true | false | null | |
| 2026-01-23 | 美容室 EARTH 銀座店 | 7800 | cat_clothing | user_wife | epos | 1回払い | AMOUNT_ONLY | true | false | null | |
| 2026-01-25 | Amazon.co.jp | -1200 | cat_daily | user_wife | epos | 1回払い | PUBLIC | true | false | null | 返品 |
| 2026-01-26 | 漫画全巻ドットコム | 4800 | cat_hobby | user_wife | epos | 1回払い | CATEGORY_TOTAL | true | false | null | |
| 2026-01-27 | サイゼリヤ 勝どき店 | 1850 | cat_food | user_wife | epos | 1回払い | PUBLIC | false | false | null | |
| 2026-01-28 | Spotify | 980 | cat_subscription | user_wife | epos | 1回払い | PUBLIC | true | false | null | |
| 2026-01-30 | ドン・キホーテ 銀座本館 | 4560 | cat_daily | user_wife | epos | 1回払い | PUBLIC | false | false | null | |

**妻の支出合計: ¥99,480**（返品含む）
**未確認: 3件**（Amazon日用品、サイゼリヤ、ドンキ）

### 4.2 夫の支出（2026年1月・MUFG JCBカード）

固定費 + 大型出費中心。

| date | description | amount | category_id | user_id | card_source | payment_method | visibility | is_confirmed | is_substitute | substitute_amount | memo |
|------|-------------|--------|-------------|---------|-------------|----------------|------------|--------------|---------------|-------------------|------|
| 2026-01-03 | ヨドバシカメラ マルチメディアAkiba | 45000 | cat_other | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | イヤホン |
| 2026-01-05 | 東京電力エナジーパートナー | 8500 | cat_utility | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | |
| 2026-01-05 | 東京ガス | 4200 | cat_utility | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | |
| 2026-01-06 | NTTドコモ | 8800 | cat_telecom | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | |
| 2026-01-07 | au（KDDI） | 5500 | cat_telecom | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | 妻の回線 |
| 2026-01-08 | Suica チャージ | 5000 | cat_transport | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | オートチャージ |
| 2026-01-10 | Amazon.co.jp | 2800 | cat_daily | user_husband | mufg_jcb | 1回払い | PUBLIC | false | false | null | |
| 2026-01-12 | コストコ 幕張倉庫店 | 18900 | cat_food | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | 週末まとめ買い |
| 2026-01-14 | ENEOS セルフ豊洲 | 6800 | cat_car | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | ガソリン |
| 2026-01-15 | Apple.com/bill | 36000 | cat_other | user_husband | mufg_jcb | 3回払い | PUBLIC | true | false | null | MacBook修理 |
| 2026-01-17 | SBI損保 | 4500 | cat_insurance | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | 自動車保険 |
| 2026-01-19 | 同僚との飲み会（居酒屋） | 8200 | cat_social | user_husband | mufg_jcb | 1回払い | AMOUNT_ONLY | true | false | null | |
| 2026-01-20 | 楽天市場 | 3400 | cat_daily | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | 文房具 |
| 2026-01-22 | マクドナルド 豊洲店 | 1280 | cat_food | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | |
| 2026-01-24 | Steam | 6800 | cat_hobby | user_husband | mufg_jcb | 1回払い | CATEGORY_TOTAL | true | false | null | ゲーム購入 |
| 2026-01-25 | Y!mobile | 3200 | cat_telecom | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | 予備回線 |
| 2026-01-28 | Amazon Prime会費 | 600 | cat_subscription | user_husband | mufg_jcb | 1回払い | PUBLIC | true | false | null | 年間プラン月割 |

### 4.3 夫の支出（2026年1月・MUFG VISAカード）

サブ利用カード。

| date | description | amount | category_id | user_id | card_source | payment_method | visibility | is_confirmed | is_substitute | substitute_amount | memo |
|------|-------------|--------|-------------|---------|-------------|----------------|------------|--------------|---------------|-------------------|------|
| 2026-01-02 | 西友 豊洲店 | 5600 | cat_food | user_husband | mufg_visa | 1回払い | PUBLIC | true | false | null | |
| 2026-01-05 | 家賃（管理費込） | 95000 | cat_housing | user_husband | mufg_visa | 1回払い | PUBLIC | true | false | null | |
| 2026-01-09 | ニトリ オンラインショップ | 24000 | cat_daily | user_husband | mufg_visa | 3回払い | PUBLIC | true | false | null | 本棚 |
| 2026-01-11 | スシロー 豊洲店 | 4200 | cat_food | user_husband | mufg_visa | 1回払い | PUBLIC | true | false | null | 家族ランチ |
| 2026-01-16 | JR東日本 えきねっと | 12000 | cat_transport | user_husband | mufg_visa | 1回払い | PUBLIC | true | false | null | 帰省用新幹線 |
| 2026-01-19 | ビックカメラ.com | 8900 | cat_other | user_husband | mufg_visa | 1回払い | PUBLIC | false | false | null | |
| 2026-01-23 | サンドラッグ 月島店 | 2100 | cat_daily | user_husband | mufg_visa | 1回払い | PUBLIC | true | false | null | |
| 2026-01-26 | Uber Eats | 2800 | cat_food | user_husband | mufg_visa | 1回払い | PUBLIC | true | false | null | |
| 2026-01-29 | 東京都水道局 | 3400 | cat_utility | user_husband | mufg_visa | 1回払い | PUBLIC | true | false | null | 2ヶ月に1回 |

**夫の支出合計（2カード）: ¥327,480**
**未確認: 2件**（Amazon日用品、ビックカメラ）

### 4.4 支出サマリー

| 項目 | 金額 |
|------|------|
| 妻の支出 | ¥99,480 |
| 夫の支出 | ¥327,480 |
| **世帯合計** | **¥426,960** |
| 予算 | ¥400,000 |
| **予算超過** | **¥26,960 (6.7%)** |
| 未確認件数 | 5件 |
| 立替あり | 1件 |
| 返品 | 1件 |

**テストシナリオとして意図的に含めたケース**:
- ✅ 予算超過（全体で6.7%超過 → ダッシュボードの警告テスト）
- ✅ 未確認支出（5件 → フィルターとバッジのテスト）
- ✅ 立替払い（居酒屋 → 自己負担計算のテスト）
- ✅ 返品/マイナス金額（Amazon → 金額表示の符号テスト）
- ✅ 分割払い（3件 → 分割管理画面のテスト）
- ✅ CATEGORY_TOTAL表示（個人娯楽 → プライバシーフィルターのテスト）
- ✅ AMOUNT_ONLY表示（交際費、衣服 → 店舗名マスクのテスト）
- ✅ 固定費（家賃、光熱費、通信費 → 固定費判定のテスト）
- ✅ 同一店舗で複数回購入（Amazon → 重複検知ロジックのテスト）

---

## 5. 分割払い (installments)

CSVから検出された分割払い + 支出テーブルとの紐付け。

| id | expense_id | user_id | description | total_amount | monthly_amount | total_installments | remaining_installments | fee | start_month | card_source |
|----|-----------|---------|-------------|-------------|----------------|-------------------|----------------------|-----|-------------|-------------|
| inst_01 | (ZARA) | user_wife | ZARA オンラインストア | 12000 | 4000 | 3 | 2 | 0 | 2026-01 | epos |
| inst_02 | (Apple) | user_husband | Apple.com/bill MacBook修理 | 36000 | 12400 | 3 | 3 | 1200 | 2026-01 | mufg_jcb |
| inst_03 | (ニトリ) | user_husband | ニトリ 本棚 | 24000 | 8267 | 3 | 3 | 800 | 2026-01 | mufg_visa |

**分割払いサマリー**:
- 月々支払合計: ¥24,667
- 残債合計: ¥74,000（手数料込: ¥76,000）
- 全件完済予定: 2026年4月

---

## 6. CSV取り込み履歴 (csv_imports)

| id | user_id | card_source | year_month | imported_at | record_count | status |
|----|---------|-------------|------------|-------------|-------------|--------|
| imp_01 | user_wife | epos | 2026-01 | 2026-02-01T10:00:00 | 18 | COMPLETED |
| imp_02 | user_husband | mufg_jcb | 2026-01 | 2026-02-01T10:15:00 | 17 | COMPLETED |
| imp_03 | user_husband | mufg_visa | 2026-01 | 2026-02-01T10:20:00 | 9 | COMPLETED |

**2026年2月分は未取り込み** → ダッシュボードのアラートテスト用

---

## 7. Prisma seed.ts 実装ガイド

```typescript
// prisma/seed.ts の構造イメージ

import { PrismaClient } from '@prisma/client';
import bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

async function main() {
  // 1. ユーザー作成
  const husband = await prisma.user.upsert({
    where: { email: 'taro@example.com' },
    update: {},
    create: {
      id: 'user_husband',
      name: '太郎',
      email: 'taro@example.com',
      password: await bcrypt.hash('password123', 10),
      role: 'ADMIN',
    },
  });

  // 2. カテゴリ作成（上記テーブルの全件）

  // 3. 予算作成（2026年1月・2月の2ヶ月分）

  // 4. 支出データ投入（上記の全明細）

  // 5. 分割払い作成

  // 6. CSV取り込み履歴作成

  console.log('✅ Seed data inserted successfully');
}

main()
  .catch(e => { console.error(e); process.exit(1); })
  .finally(() => prisma.$disconnect());
```

**実行方法**:
```bash
pnpm prisma db seed
```

**package.json に追加**:
```json
{
  "prisma": {
    "seed": "tsx prisma/seed.ts"
  }
}
```

---

## 8. テスト用チェックリスト

シードデータ投入後、以下の表示・動作を確認する。

### ダッシュボード
- [ ] 残予算がマイナス（予算超過）で赤表示されること
- [ ] 先月比が表示されること（1月分しかないため「先月データなし」でも可）
- [ ] アラート: 「2月分CSV未取り込み」が3件表示されること
- [ ] アラート: 「未確認5件」が表示されること
- [ ] 分割払いカードに残債¥76,000・月々¥24,667が表示されること

### 支出一覧
- [ ] 未確認フィルターで5件に絞れること
- [ ] 立替支出（居酒屋）に🔄マークと自己負担額が表示されること
- [ ] 返品（Amazon -¥1,200）が緑色で表示されること
- [ ] プライバシー🔒マークが適切に表示されること
- [ ] 分割払いバッジが表示されること

### 家計レビュー
- [ ] カテゴリ別グラフで食費・日用品が予算超過（赤）になること
- [ ] 夫婦比率が約77:23で表示されること
- [ ] CATEGORY_TOTAL設定の「個人娯楽」が合計のみ表示されること
- [ ] AMOUNT_ONLY設定の支出で店舗名が非表示になること

### 分割払い管理
- [ ] 3件の分割払いがカード形式で表示されること
- [ ] 完済予定月が正しいこと
